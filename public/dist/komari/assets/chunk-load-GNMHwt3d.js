import{R as l,j as e,u as w,L as M,t as v}from"./entry-index-B_BwMGDA.js";import{C as U,u as V,g as q,v as x,N as L,T as G}from"./chunk-NodeSelectorDialog-D1EHYvTB.js";import{T as K,a as Q,c as b,d as W,b as X,e as y}from"./chunk-table-C7OLDXxB.js";import{N as Y,u as $}from"./chunk-NodeDetailsContext-zCokq4cf.js";import{E as Z}from"./chunk-ellipsis-CAHuwugl.js";import{P as ee}from"./chunk-pencil-sgIEyw2j.js";import{p as T}from"./chunk-flex-BCOyAvOQ.js";import{s as E,n as D,p as k,g as P,D as _}from"./chunk-dialog-DNX9FVqx.js";import{o as C}from"./chunk-button-BYJQxefP.js";import{u as g}from"./chunk-text-field-DU038-QT.js";import{o as A}from"./chunk-icon-button-CMpL5Fj6.js";import"./chunk-icons-Du45HjA-.js";import"./chunk-base-button-CCk1VYTx.js";import"./chunk-index-B6kNq_40.js";import"./chunk-require-react-element-nXeqDkbS.js";import"./chunk-index-BNFPzONB.js";import"./chunk-NodeSelector-X9lICC_p.js";import"./chunk-search-BdPb8rle.js";import"./chunk-checkbox-DQkPJIPQ.js";import"./chunk-internal-DlW9DyfA.js";import"./chunk-utils-bRKmu4jq.js";import"./chunk-heading-DUyPxxaV.js";import"./chunk-text-2n0Dx3l-.js";const z=l.createContext(void 0),ne=({children:n})=>{const[r,d]=l.useState(null),[p,m]=l.useState(!1),[i,a]=l.useState(null),u=()=>{a(null),fetch("/api/admin/notification/load").then(c=>{if(!c.ok)throw new Error("Failed to fetch notification tasks");return c.json()}).then(c=>{c&&Array.isArray(c.data)?d(c.data):d([])}).catch(c=>{a(c.message||"An error occurred while fetching load alerts")}).finally(()=>{m(!1)})};return l.useEffect(()=>{m(!0),u(),m(!1)},[]),e.jsx(z.Provider,{value:{loadAlerts:r,isLoading:p,error:i,refresh:u},children:n})},R=()=>{const n=l.useContext(z);if(!n)throw new Error("useLoadAlert must be used within a LoadAlertProvider");return n},Ee=()=>e.jsx(ne,{children:e.jsx(Y,{children:e.jsx(te,{})})}),te=()=>{const{loadAlerts:n,isLoading:r,error:d}=R(),{isLoading:p,error:m}=$(),{t:i}=w();return r||p?e.jsx(M,{}):d||m?e.jsx("div",{children:d||m}):e.jsxs(T,{direction:"column",gap:"4",className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-2xl font-bold",children:i("notification.load.title")}),e.jsx(re,{})]}),e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(b,{children:i("common.name")}),e.jsx(b,{children:i("common.server")}),e.jsx(b,{children:i("loadAlert.metric")}),e.jsx(b,{children:i("common.threshold")}),e.jsx(b,{children:i("loadAlert.ratio")}),e.jsx(b,{children:i("ping.interval")}),e.jsx(b,{children:i("common.action")})]}),e.jsx(W,{children:n==null?void 0:n.slice().sort((a,u)=>(u.id??0)-(a.id??0)).map(a=>e.jsx(se,{alert:a},a.id))})]})})]})},se=({alert:n})=>{var I;const{t:r}=w(),{refresh:d}=R(),{nodeDetail:p}=$(),[m,i]=l.useState(!1),[a,u]=l.useState(!1),[c,N]=l.useState(!1),[O,j]=l.useState(!1),[h,o]=l.useState({name:n.name||"",metric:n.metric||"cpu",threshold:n.threshold||80,ratio:n.ratio||.8,clients:n.clients||[],interval:n.interval||15}),f=t=>{u(!0),fetch("/api/admin/notification/load/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notifications:[{id:n.id,name:t.name,metric:t.metric,threshold:t.threshold,ratio:t.ratio,clients:t.clients,interval:t.interval}]})}).then(s=>s.ok?s.json():s.json().then(S=>{throw new Error((S==null?void 0:S.message)||r("common.error"))})).then(()=>{i(!1),v.success(r("common.updated_successfully")),d()}).catch(s=>{v.error(s.message)}).finally(()=>u(!1))},J=t=>{t.preventDefault(),f(h)},B=()=>{j(!0),fetch("/api/admin/notification/load/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[n.id]})}).then(t=>t.ok?t.json():t.json().then(s=>{throw new Error((s==null?void 0:s.message)||r("common.error"))})).then(()=>{N(!1),v.success(r("common.deleted_successfully")),d()}).catch(t=>{v.error(t.message)}).finally(()=>j(!1))};return e.jsxs(X,{children:[e.jsx(y,{children:n.name}),e.jsx(y,{children:e.jsxs(T,{gap:"2",align:"center",children:[n.clients&&n.clients.length>0?(()=>{const s=n.clients.map(S=>{var F;return((F=p.find(H=>H.uuid===S))==null?void 0:F.name)||S}).join(", ");return s.length>40?s.slice(0,40)+"...":s})():r("common.none"),e.jsx(L,{value:h.clients??[],hiddenUuidOnlyClient:!0,onChange:t=>{o(s=>({...s,clients:t})),f({...h,clients:t})},children:e.jsx(A,{variant:"ghost",children:e.jsx(Z,{size:"16"})})})]})}),e.jsx(y,{children:(I=n.metric)==null?void 0:I.toUpperCase()}),e.jsxs(y,{children:[n.threshold,"%"]}),e.jsx(y,{children:n.ratio}),e.jsxs(y,{children:[n.interval," ",r("time.minute")]}),e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsxs(E,{open:m,onOpenChange:i,children:[e.jsx(D,{children:e.jsx(A,{variant:"soft",children:e.jsx(ee,{size:"16"})})}),e.jsxs(k,{children:[e.jsx(P,{children:r("common.edit")}),e.jsxs("form",{onSubmit:J,className:"flex flex-col gap-2",children:[e.jsx("label",{children:r("common.name")}),e.jsx(g,{value:h.name,onChange:t=>o(s=>({...s,name:t.target.value})),required:!0}),e.jsx("label",{children:r("loadAlert.metric")}),e.jsxs(U,{value:h.metric,onValueChange:t=>o(s=>({...s,metric:t})),children:[e.jsx(V,{}),e.jsxs(q,{children:[e.jsx(x,{value:"cpu",children:"CPU"}),e.jsx(x,{value:"ram",children:"RAM"}),e.jsx(x,{value:"disk",children:"Disk"}),e.jsx(x,{value:"net_in",children:"Net In"}),e.jsx(x,{value:"net_out",children:"Net Out"})]})]}),e.jsxs("label",{children:[r("common.threshold")," (%)"]}),e.jsx(g,{type:"number",value:h.threshold,onChange:t=>o(s=>({...s,threshold:Number(t.target.value)})),required:!0}),e.jsx("label",{children:r("loadAlert.ratio")}),e.jsx(g,{type:"number",step:"0.1",min:"0",max:"1",value:h.ratio,onChange:t=>o(s=>({...s,ratio:Number(t.target.value)})),required:!0}),e.jsx("label",{children:r("common.server")}),e.jsx(T,{children:e.jsx(L,{value:h.clients,hiddenUuidOnlyClient:!0,onChange:t=>o(s=>({...s,clients:t}))})}),e.jsxs("label",{children:[r("ping.interval")," (",r("time.minute"),")"]}),e.jsx(g,{type:"number",value:h.interval,onChange:t=>o(s=>({...s,interval:Number(t.target.value)})),required:!0}),e.jsxs(T,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(_,{children:e.jsx(C,{variant:"soft",color:"gray",type:"button",onClick:()=>i(!1),children:r("common.cancel")})}),e.jsx(C,{variant:"solid",type:"submit",disabled:a,children:r("common.save")})]})]})]})]}),e.jsxs(E,{open:c,onOpenChange:N,children:[e.jsx(D,{children:e.jsx(A,{variant:"soft",color:"red",children:e.jsx(G,{size:"16"})})}),e.jsxs(k,{children:[e.jsx(P,{children:r("common.delete")}),e.jsxs(T,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(_,{children:e.jsx(C,{variant:"soft",color:"gray",type:"button",onClick:()=>N(!1),children:r("common.cancel")})}),e.jsx(C,{variant:"solid",color:"red",onClick:B,disabled:O,children:r("common.delete")})]})]})]})]})]},n.id)},re=()=>{const{t:n}=w(),[r,d]=l.useState(!1),[p,m]=l.useState([]),{refresh:i}=R(),[a,u]=l.useState("cpu"),[c,N]=l.useState(!1),O=j=>{j.preventDefault();const h={name:j.currentTarget.load_name.value,metric:a,threshold:parseFloat(j.currentTarget.threshold.value),ratio:parseFloat(j.currentTarget.ratio.value),clients:p,interval:parseInt(j.currentTarget.interval.value,10)};N(!0),fetch("/api/admin/notification/load/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).then(o=>{o.ok?(d(!1),m([]),u("cpu"),v.success(n("common.success"))):o.json().then(f=>{v.error((f==null?void 0:f.message)||n("common.error"))}).catch(f=>{v.error(f.message)})}).catch(o=>{console.error("Error adding load alert:",o),v.error(o.message)}).finally(()=>{N(!1),i()})};return e.jsxs(E,{open:r,onOpenChange:d,children:[e.jsx(D,{children:e.jsx(C,{children:n("common.add")})}),e.jsxs(k,{children:[e.jsx(P,{children:n("common.add")}),e.jsx("form",{onSubmit:O,children:e.jsxs(T,{direction:"column",justify:"end",gap:"2",className:"font-bold",children:[e.jsx("label",{htmlFor:"load_name",children:n("common.name")}),e.jsx(g,{id:"load_name",name:"load_name"}),e.jsx("label",{htmlFor:"type",children:n("loadAlert.metric")}),e.jsxs(U,{value:a,onValueChange:j=>u(j),children:[e.jsx(V,{id:"type",name:"type"}),e.jsxs(q,{children:[e.jsx(x,{value:"cpu",children:"CPU"}),e.jsx(x,{value:"ram",children:"RAM"}),e.jsx(x,{value:"disk",children:"Disk"}),e.jsx(x,{value:"net_in",children:"Net In"}),e.jsx(x,{value:"net_out",children:"Net Out"})]})]}),e.jsxs("label",{htmlFor:"threshold",children:[n("common.threshold")," (%)"]}),e.jsx(g,{id:"threshold",name:"threshold",type:"number",defaultValue:80,step:"0.1"}),e.jsx("label",{htmlFor:"ratio",children:n("loadAlert.ratio")}),e.jsx(g,{id:"ratio",name:"ratio",type:"number",step:"0.1",min:"0",max:"1",defaultValue:.8}),e.jsx("label",{htmlFor:"select",children:n("common.server")}),e.jsxs("div",{className:"flex items-center justify-start gap-2",children:[e.jsx(L,{value:p,onChange:m}),e.jsx("label",{className:"text-md font-normal",children:n("common.selected",{count:p.length})})]}),e.jsxs("label",{htmlFor:"interval",children:[n("ping.interval")," (",n("time.minute"),")"]}),e.jsx(g,{id:"interval",name:"interval",defaultValue:15,type:"number",placeholder:"15"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{children:e.jsx(C,{variant:"soft",children:n("common.close")})}),e.jsx(C,{disabled:c,type:"submit",children:n("common.add")})]})]})})]})]})};export{Ee as default};
