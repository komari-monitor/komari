import{r,b as L,j as x,R as c}from"./entry-index-B_BwMGDA.js";const C=r.createContext({live_data:null,showCallout:!0,onRefresh:()=>{}}),j=({children:s})=>{const[f,n]=r.useState(null),[m,u]=r.useState(!1),[d]=r.useState(new Set),{call:l}=L(),v=o=>{d.add(o)},p=o=>{d.forEach(i=>i(o))};return r.useEffect(()=>{let o,i=!1,t=!1;const b=2e3,g=async()=>{if(!t){t=!0;try{const _=await l("common:getNodesLatestStatus"),k=Object.values(_).filter(a=>a==null?void 0:a.online).map(a=>a.client),w={};for(const[a,N]of Object.entries(_)){const e=N;w[a]={cpu:{usage:typeof e.cpu=="number"?e.cpu:0},ram:{used:e.ram??0},swap:{used:e.swap??0},load:{load1:e.load??0,load5:e.load5??0,load15:e.load15??0},disk:{used:e.disk??0},network:{up:e.net_out??0,down:e.net_in??0,totalUp:e.net_total_out??e.net_total_up??0,totalDown:e.net_total_in??e.net_total_down??0},connections:{tcp:e.connections??0,udp:e.connections_udp??0},gpu:e.gpu!==void 0?{count:0,average_usage:e.gpu,detailed_info:[]}:void 0,uptime:e.uptime??0,process:e.process??0,message:"",updated_at:e.time??0}}const h={data:{online:k,data:w},status:"ok"};n(h),u(!0),p(h)}catch(_){console.error("RPC2 获取最新状态失败:",_),u(!1)}finally{t=!1,i||(o=window.setTimeout(g,b))}}};return g(),()=>{i=!0,o&&window.clearTimeout(o)}},[l]),x.jsx(C.Provider,{value:{live_data:f,showCallout:m,onRefresh:v},children:s})},R=()=>r.useContext(C),y=c.createContext(void 0),E=({children:s})=>{const[f,n]=c.useState(null),[m,u]=c.useState(!0),[d,l]=c.useState(null),{call:v}=L(),p=()=>{l(null),v("common:getNodes").then(o=>{if(!o||typeof o!="object"){n([]);return}const i=Object.values(o).map(t=>({uuid:t.uuid,name:t.name,cpu_name:t.cpu_name,virtualization:t.virtualization,arch:t.arch,cpu_cores:t.cpu_cores,os:t.os,kernel_version:t.kernel_version,gpu_name:t.gpu_name,region:t.region,mem_total:t.mem_total,swap_total:t.swap_total,disk_total:t.disk_total,version:t.version??"",weight:t.weight??0,price:t.price??0,tags:t.tags??"",billing_cycle:t.billing_cycle??0,currency:t.currency??"",group:t.group??"",traffic_limit:t.traffic_limit??0,traffic_limit_type:t.traffic_limit_type,expired_at:t.expired_at??"",created_at:t.created_at??"",updated_at:t.updated_at??"",ipv4:t.ipv4,ipv6:t.ipv6}));n(i)}).catch(o=>{l((o==null?void 0:o.message)||"An error occurred while fetching data"),n([])}).finally(()=>{u(!1)})};return c.useEffect(()=>{p()},[]),x.jsx(y.Provider,{value:{nodeList:f,isLoading:m,error:d,refresh:p},children:s})},P=()=>{const s=c.useContext(y);if(!s)throw new Error("useNodeList must be used within a NodeListProvider");return s};export{j as L,E as N,P as a,R as u};
