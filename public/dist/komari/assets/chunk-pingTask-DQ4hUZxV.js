import{r as b,H as ve,j as e,o as be,C as $,k as z,P as ye,y as k,R as f,u as P,t as T,L as Te}from"./entry-index-B_BwMGDA.js";import{N as H,C as Q,u as X,g as Y,v as E,T as Se}from"./chunk-NodeSelectorDialog-D1EHYvTB.js";import{u as F,N as Ce}from"./chunk-NodeDetailsContext-zCokq4cf.js";import{u as Ne}from"./chunk-api-h1eiz4mP.js";import{T as Z,a as ee,c as N,d as te,b as se,e as w}from"./chunk-table-C7OLDXxB.js";import{E as ne}from"./chunk-ellipsis-CAHuwugl.js";import{P as we}from"./chunk-pencil-sgIEyw2j.js";import{v as J,r as K,p as _}from"./chunk-flex-BCOyAvOQ.js";import{o as R}from"./chunk-icon-button-CMpL5Fj6.js";import{s as L,n as M,p as O,g as A,D as B}from"./chunk-dialog-DNX9FVqx.js";import{u as I}from"./chunk-text-field-DU038-QT.js";import{o as C}from"./chunk-button-BYJQxefP.js";import{S as _e}from"./chunk-NodeSelector-X9lICC_p.js";import{o as Pe,r as Ee}from"./chunk-base-button-CCk1VYTx.js";import{c as re,R as Ie,I as De}from"./chunk-index-CC8wkri2.js";import{u as Re,a as Le}from"./chunk-require-react-element-nXeqDkbS.js";import{p as Me}from"./chunk-box-B1i8JWQr.js";import"./chunk-icons-Du45HjA-.js";import"./chunk-index-B6kNq_40.js";import"./chunk-index-BNFPzONB.js";import"./chunk-utils-bRKmu4jq.js";import"./chunk-heading-DUyPxxaV.js";import"./chunk-text-2n0Dx3l-.js";import"./chunk-internal-DlW9DyfA.js";import"./chunk-search-BdPb8rle.js";import"./chunk-checkbox-DQkPJIPQ.js";var V="Tabs",[Oe,wt]=be(V,[re]),ae=re(),[Ae,U]=Oe(V),ie=b.forwardRef((t,s)=>{const{__scopeTabs:a,value:n,onValueChange:r,defaultValue:o,orientation:i="horizontal",dir:d,activationMode:m="automatic",...h}=t,x=ve(d),[u,j]=Re({prop:n,onChange:r,defaultProp:o??"",caller:V});return e.jsx(Ae,{scope:a,baseId:Le(),value:u,onValueChange:j,orientation:i,dir:x,activationMode:m,children:e.jsx($.div,{dir:x,"data-orientation":i,...h,ref:s})})});ie.displayName=V;var oe="TabsList",le=b.forwardRef((t,s)=>{const{__scopeTabs:a,loop:n=!0,...r}=t,o=U(oe,a),i=ae(a);return e.jsx(Ie,{asChild:!0,...i,orientation:o.orientation,dir:o.dir,loop:n,children:e.jsx($.div,{role:"tablist","aria-orientation":o.orientation,...r,ref:s})})});le.displayName=oe;var ce="TabsTrigger",de=b.forwardRef((t,s)=>{const{__scopeTabs:a,value:n,disabled:r=!1,...o}=t,i=U(ce,a),d=ae(a),m=he(i.baseId,n),h=pe(i.baseId,n),x=n===i.value;return e.jsx(De,{asChild:!0,...d,focusable:!r,active:x,children:e.jsx($.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":h,"data-state":x?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:m,...o,ref:s,onMouseDown:z(t.onMouseDown,u=>{!r&&u.button===0&&u.ctrlKey===!1?i.onValueChange(n):u.preventDefault()}),onKeyDown:z(t.onKeyDown,u=>{[" ","Enter"].includes(u.key)&&i.onValueChange(n)}),onFocus:z(t.onFocus,()=>{const u=i.activationMode!=="manual";!x&&!r&&u&&i.onValueChange(n)})})})});de.displayName=ce;var me="TabsContent",ue=b.forwardRef((t,s)=>{const{__scopeTabs:a,value:n,forceMount:r,children:o,...i}=t,d=U(me,a),m=he(d.baseId,n),h=pe(d.baseId,n),x=n===d.value,u=b.useRef(x);return b.useEffect(()=>{const j=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(j)},[]),e.jsx(ye,{present:r||x,children:({present:j})=>e.jsx($.div,{"data-state":x?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":m,hidden:!j,id:h,tabIndex:0,...i,ref:s,style:{...t.style,animationDuration:u.current?"0s":void 0},children:j&&o})})});ue.displayName=me;function he(t,s){return`${t}-trigger-${s}`}function pe(t,s){return`${t}-content-${s}`}var Be=ie,$e=le,ke=de,Fe=ue;const Ve=["1","2"],ze=["nowrap","wrap","wrap-reverse"],He=["start","center","end"],Ge={size:{type:"enum",className:"rt-r-size",values:Ve,default:"2",responsive:!0},wrap:{type:"enum",className:"rt-r-fw",values:ze,responsive:!0},justify:{type:"enum",className:"rt-r-jc",values:He,responsive:!0},...Ee,...Pe},ge=b.forwardRef((t,s)=>{const{className:a,...n}=J(t,K);return b.createElement(Be,{...n,ref:s,className:k("rt-TabsRoot",a)})});ge.displayName="Tabs.Root";const fe=b.forwardRef((t,s)=>{const{className:a,color:n,...r}=J(t,Ge,K);return b.createElement($e,{"data-accent-color":n,...r,asChild:!1,ref:s,className:k("rt-BaseTabList","rt-TabsList",a)})});fe.displayName="Tabs.List";const G=b.forwardRef((t,s)=>{const{className:a,children:n,...r}=t;return b.createElement(ke,{...r,asChild:!1,ref:s,className:k("rt-reset","rt-BaseTabListTrigger","rt-TabsTrigger",a)},b.createElement("span",{className:"rt-BaseTabListTriggerInner rt-TabsTriggerInner"},n),b.createElement("span",{className:"rt-BaseTabListTriggerInnerHidden rt-TabsTriggerInnerHidden"},n))});G.displayName="Tabs.Trigger";const q=b.forwardRef((t,s)=>{const{className:a,...n}=J(t,K);return b.createElement(Fe,{...n,ref:s,className:k("rt-TabsContent",a)})});q.displayName="Tabs.Content";const xe=f.createContext(void 0),qe=({children:t})=>{const[s,a]=f.useState(null),[n,r]=f.useState(!1),[o,i]=f.useState(null),d=()=>{i(null),fetch("/api/admin/ping").then(m=>{if(!m.ok)throw new Error("Failed to fetch ping tasks");return m.json()}).then(m=>{m&&Array.isArray(m.data)?a(m.data):a([])}).catch(m=>{i(m.message||"An error occurred while fetching ping tasks")}).finally(()=>{r(!1)})};return f.useEffect(()=>{r(!0),d(),r(!1)},[]),e.jsx(xe.Provider,{value:{pingTasks:s,isLoading:n,error:o,refresh:d},children:t})},D=()=>{const t=f.useContext(xe);if(!t)throw new Error("usePingTask must be used within a PingTaskProvider");return t},Je=({pingTasks:t})=>{const{t:s}=P(),{nodeDetail:a}=F(),n=f.useMemo(()=>{if(!t)return[];const r=new Set(a.map(o=>o.uuid));return t.map(o=>{const i=o.clients||[],d=i.filter(h=>r.has(h)),m=i.length>0&&d.length===0;return{...o,clients:d,__allClientsDeleted:m,__originalCount:i.length}}).sort((o,i)=>(i.id??0)-(o.id??0))},[t,a]);return e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(N,{children:s("common.name")}),e.jsx(N,{children:s("common.server")}),e.jsx(N,{children:s("ping.target")}),e.jsx(N,{children:s("ping.type")}),e.jsx(N,{children:s("ping.interval")}),e.jsx(N,{children:s("common.action")})]}),e.jsx(te,{children:n.map(r=>e.jsx(Ke,{task:r},r.id))})]})})},Ke=({task:t})=>{const{t:s}=P(),{refresh:a}=D(),{nodeDetail:n}=F(),[r,o]=f.useState(!1),[i,d]=f.useState(!1),[m,h]=f.useState(!1),[x,u]=f.useState(!1),[j,v]=f.useState({name:t.name||"",type:t.type||"icmp",target:t.target||"",clients:t.clients||[],interval:t.interval||60}),y=l=>{d(!0),fetch("/api/admin/ping/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:[{id:t.id,name:l.name,type:l.type,target:l.target,clients:l.clients,interval:l.interval}]})}).then(c=>c.ok?c.json():c.json().then(S=>{throw new Error((S==null?void 0:S.message)||s("common.error"))})).then(()=>{o(!1),T.success(s("common.updated_successfully")),a()}).catch(c=>{T.error(c.message)}).finally(()=>d(!1))},p=l=>{l.preventDefault(),y(j)},g=()=>{u(!0),fetch("/api/admin/ping/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[t.id]})}).then(l=>l.ok?l.json():l.json().then(c=>{throw new Error((c==null?void 0:c.message)||s("common.error"))})).then(()=>{h(!1),T.success(s("common.deleted_successfully")),a()}).catch(l=>{T.error(l.message)}).finally(()=>u(!1))};return e.jsxs(se,{children:[e.jsx(w,{children:t.name}),e.jsx(w,{children:e.jsxs(_,{gap:"2",align:"center",children:[t.clients&&t.clients.length>0?(()=>{const c=t.clients.map(S=>{var W;return((W=n.find(je=>je.uuid===S))==null?void 0:W.name)||S}).join(", ");return c.length>40?c.slice(0,40)+"...":c})():s("common.none"),e.jsx(H,{value:j.clients??[],onChange:l=>{v(c=>({...c,clients:l})),y({...j,clients:l})},children:e.jsx(R,{variant:"ghost",children:e.jsx(ne,{size:"16"})})})]})}),e.jsx(w,{children:t.target}),e.jsx(w,{children:t.type}),e.jsx(w,{children:t.interval}),e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsxs(L,{open:r,onOpenChange:o,children:[e.jsx(M,{children:e.jsx(R,{variant:"soft",children:e.jsx(we,{size:"16"})})}),e.jsxs(O,{children:[e.jsx(A,{children:s("common.edit")}),e.jsxs("form",{onSubmit:p,className:"flex flex-col gap-2",children:[e.jsx("label",{children:s("common.name")}),e.jsx(I,{value:j.name,onChange:l=>v(c=>({...c,name:l.target.value})),required:!0}),e.jsx("label",{children:s("ping.type")}),e.jsxs(Q,{value:j.type,onValueChange:l=>v(c=>({...c,type:l})),children:[e.jsx(X,{}),e.jsxs(Y,{children:[e.jsx(E,{value:"icmp",children:"ICMP"}),e.jsx(E,{value:"tcp",children:"TCP"}),e.jsx(E,{value:"http",children:"HTTP"})]})]}),e.jsx("label",{children:s("ping.target")}),e.jsx(I,{value:j.target,onChange:l=>v(c=>({...c,target:l.target.value})),required:!0}),e.jsx("label",{children:s("common.server")}),e.jsx(_,{children:e.jsx(H,{value:j.clients,onChange:l=>v(c=>({...c,clients:l}))})}),e.jsxs("label",{children:[s("ping.interval")," (",s("time.second"),")"]}),e.jsx(I,{type:"number",value:j.interval,onChange:l=>v(c=>({...c,interval:Number(l.target.value)})),required:!0}),e.jsxs(_,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(B,{children:e.jsx(C,{variant:"soft",color:"gray",type:"button",onClick:()=>o(!1),children:s("common.cancel")})}),e.jsx(C,{variant:"solid",type:"submit",disabled:i,children:s("common.save")})]})]})]})]}),e.jsxs(L,{open:m,onOpenChange:h,children:[e.jsx(M,{children:e.jsx(R,{variant:"soft",color:"red",children:e.jsx(Se,{size:"16"})})}),e.jsxs(O,{children:[e.jsx(A,{children:s("common.delete")}),e.jsxs(_,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(B,{children:e.jsx(C,{variant:"soft",color:"gray",type:"button",onClick:()=>h(!1),children:s("common.cancel")})}),e.jsx(C,{variant:"solid",color:"red",onClick:g,disabled:x,children:s("common.delete")})]})]})]})]})]},t.id)},Ue=({pingTasks:t})=>{const{t:s}=P(),{nodeDetail:a}=F(),n=f.useMemo(()=>[...a].sort((r,o)=>{const i=r.weight??0,d=o.weight??0;return i!==d?i-d:r.name.localeCompare(o.name)}),[a]);return e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(N,{className:"w-48",children:s("common.server")}),e.jsx(N,{children:s("ping.task")})]}),e.jsx(te,{children:n.map(r=>e.jsx(We,{nodeUuid:r.uuid,nodeName:r.name,pingTasks:t},r.uuid))})]})})},We=({nodeUuid:t,nodeName:s,pingTasks:a})=>{const{t:n}=P(),{refresh:r}=D(),[o,i]=f.useState(!1),[d,m]=f.useState(!1),h=f.useMemo(()=>a.filter(p=>{var g;return(g=p.clients)==null?void 0:g.includes(t)}),[a,t]),[x,u]=f.useState(()=>h.filter(p=>p.id!==void 0).map(p=>String(p.id)));f.useEffect(()=>{u(h.filter(p=>p.id!==void 0).map(p=>String(p.id)))},[h]);const j=()=>{m(!0);const p=a.filter(g=>g.id!==void 0).filter(g=>{var S;const l=!!((S=g.clients)!=null&&S.includes(t)),c=x.includes(String(g.id));return l!==c}).map(g=>{const l=x.includes(String(g.id)),c=new Set(g.clients||[]);return l?c.add(t):c.delete(t),{id:g.id,name:g.name,type:g.type,target:g.target,clients:Array.from(c),interval:g.interval}});if(p.length===0){i(!1),m(!1);return}fetch("/api/admin/ping/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:p})}).then(g=>g.ok?g.json():g.json().then(l=>{throw new Error((l==null?void 0:l.message)||n("common.error"))})).then(()=>{T.success(n("common.updated_successfully")),i(!1),r()}).catch(g=>T.error(g.message)).finally(()=>m(!1))},v=h.map(p=>p.name).join(", "),y=v.length>40?v.slice(0,40)+"...":v;return e.jsxs(se,{children:[e.jsx(w,{children:s}),e.jsx(w,{children:e.jsxs(_,{align:"center",gap:"2",children:[h.length>0?y:n("common.none"),e.jsxs(L,{open:o,onOpenChange:i,children:[e.jsx(M,{children:e.jsx(R,{variant:"ghost",children:e.jsx(ne,{size:16})})}),e.jsxs(O,{maxWidth:"450px",children:[e.jsxs(A,{children:[n("common.server")," - ",s]}),e.jsx("div",{className:"mt-2",children:e.jsx(_e,{value:x,onChange:u,items:[...a.filter(p=>p.id!==void 0)].reverse(),getId:p=>String(p.id),getLabel:p=>e.jsxs("span",{className:"text-sm",children:[p.name,e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:[p.type,"/",p.interval,"s"]})]}),headerLabel:n("ping.task"),searchPlaceholder:n("common.search",{defaultValue:"Search"}),filterItem:(p,g)=>String(p.name).toLowerCase().includes(g.toLowerCase())})}),e.jsxs(_,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(B,{children:e.jsx(C,{variant:"soft",color:"gray",type:"button",onClick:()=>i(!1),children:n("common.cancel")})}),e.jsx(C,{onClick:j,disabled:d,children:n("common.save")})]})]})]})]})})]})},_t=()=>e.jsx(qe,{children:e.jsx(Ce,{children:e.jsx(Qe,{})})}),Qe=()=>{const{pingTasks:t,isLoading:s,error:a}=D(),{isLoading:n,error:r}=F(),{t:o}=P();return s||n?e.jsx(Te,{}):a||r?e.jsx("div",{children:a||r}):e.jsxs(_,{direction:"column",gap:"4",className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-2xl font-bold",children:o("ping.title")}),e.jsx(Ye,{})]}),e.jsxs(ge,{defaultValue:"task",children:[e.jsxs(fe,{children:[e.jsx(G,{value:"task",children:o("ping.task_view")}),e.jsx(G,{value:"server",children:o("ping.server_view")})]}),e.jsxs(Me,{pt:"3",children:[e.jsx(q,{value:"task",children:e.jsx(Je,{pingTasks:t??[]})}),e.jsx(q,{value:"server",children:e.jsx(Ue,{pingTasks:t??[]})})]})]}),e.jsx(Xe,{})]})},Xe=()=>{const{pingTasks:t}=D(),{t:s}=P(),a=()=>{if(!t||t.length===0)return 0;const i=105*2;return t.reduce((m,h)=>{var v;const x=((v=h.clients)==null?void 0:v.length)||0,u=h.interval||60,j=x*(24*60*60)/u;return m+j},0)*i},n=i=>{if(i===0)return"0 B";const d=1024,m=["B","KB","MB","GB"],h=Math.floor(Math.log(i)/Math.log(d));return parseFloat((i/Math.pow(d,h)).toFixed(2))+" "+m[h]},{settings:r}=Ne(),o=a();return e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsxs("label",{children:[s("ping.disk_usage_estimate"),": ",n(o),"/",s("common.day"),","," ",s("ping.disk_usage_with_settings",{hour:r.ping_record_preserve_time,space:n(o*r.ping_record_preserve_time/24)})]})})},Ye=()=>{const{t}=P(),[s,a]=f.useState(!1),[n,r]=f.useState([]),{refresh:o}=D(),[i,d]=f.useState("icmp"),[m,h]=f.useState(!1),x=u=>{u.preventDefault();const j={name:u.currentTarget.ping_name.value,type:i,target:u.currentTarget.ping_target.value,clients:n,interval:parseInt(u.currentTarget.interval.value,10)};h(!0),fetch("/api/admin/ping/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}).then(v=>{v.ok?(a(!1),r([]),d("icmp"),T.success(t("common.success"))):v.json().then(y=>{T.error((y==null?void 0:y.message)||t("common.error"))}).catch(y=>{T.error(y.message)})}).catch(v=>{console.error("Error adding ping task:",v),T.error(v.message)}).finally(()=>{h(!1),o()})};return e.jsxs(L,{open:s,onOpenChange:a,children:[e.jsx(M,{children:e.jsx(C,{children:t("common.add")})}),e.jsxs(O,{children:[e.jsx(A,{children:t("common.add")}),e.jsx("form",{onSubmit:x,children:e.jsxs(_,{direction:"column",justify:"end",gap:"2",className:"font-bold",children:[e.jsx("label",{htmlFor:"ping_name",children:t("common.name")}),e.jsx(I,{id:"ping_name",name:"ping_name"}),e.jsx("label",{htmlFor:"type",children:t("ping.type")}),e.jsxs(Q,{value:i,onValueChange:u=>d(u),children:[e.jsx(X,{id:"type",name:"type"}),e.jsxs(Y,{children:[e.jsx(E,{value:"icmp",children:"ICMP"}),e.jsx(E,{value:"tcp",children:"TCP"}),e.jsx(E,{value:"http",children:"HTTP"})]})]}),e.jsx("label",{htmlFor:"ping_target",children:t("ping.target")}),e.jsx(I,{id:"ping_target",name:"ping_target",placeholder:"1.1.1.1 | 1.1.1.1:80 | https://1.1.1.1"}),e.jsx("label",{htmlFor:"ping_server",children:t("common.server")}),e.jsxs("div",{className:"flex items-center justify-start gap-2",children:[e.jsx(H,{value:n,onChange:r}),e.jsx("label",{className:"text-md font-normal",children:t("common.selected",{count:n.length})})]}),e.jsxs("label",{htmlFor:"interval",children:[t("ping.interval")," (",t("time.second"),")"]}),e.jsx(I,{id:"interval",name:"interval",defaultValue:60,type:"number",placeholder:"60"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(B,{children:e.jsx(C,{variant:"soft",children:t("common.close")})}),e.jsx(C,{disabled:m,type:"submit",children:t("common.add")})]})]})})]})]})};export{_t as default};
