import{r as d,T,u as w,j as e,e as V}from"./entry-index-B_BwMGDA.js";import{B as W,S as G}from"./chunk-react-icons.esm-C0BSBnU8.js";import{I as z,h as D,g as F,v as n}from"./chunk-dropdown-menu-DjJRBXTh.js";import{p as l}from"./chunk-text-2n0Dx3l-.js";import{o as v}from"./chunk-icon-button-CMpL5Fj6.js";import{a as H}from"./chunk-Tabler-5qQjB6LN.js";import{A as Q,u as X}from"./chunk-AccountContext-B4Xe2n3i.js";import{o as h}from"./chunk-button-BYJQxefP.js";import{s as Y,n as Z,p as I,g as ee,m as oe}from"./chunk-dialog-DNX9FVqx.js";import{p as re}from"./chunk-box-B1i8JWQr.js";import{p as le}from"./chunk-flex-BCOyAvOQ.js";import{u as b}from"./chunk-text-field-DU038-QT.js";const ge=({icon:t=e.jsx(v,{variant:"soft",children:e.jsx(W,{})})}={})=>{const{setColor:o}=d.useContext(T),{t:r}=w();return e.jsxs(z,{children:[e.jsx(D,{children:t}),e.jsxs(F,{children:[e.jsx(n,{onSelect:()=>o("gray"),children:e.jsx(l,{color:"gray",children:r("color.gray")})}),e.jsx(n,{onSelect:()=>o("gold"),children:e.jsx(l,{color:"gold",children:r("color.gold")})}),e.jsx(n,{onSelect:()=>o("bronze"),children:e.jsx(l,{color:"bronze",children:r("color.bronze")})}),e.jsx(n,{onSelect:()=>o("brown"),children:e.jsx(l,{color:"brown",children:r("color.brown")})}),e.jsx(n,{onSelect:()=>o("yellow"),children:e.jsx(l,{color:"yellow",children:r("color.yellow")})}),e.jsx(n,{onSelect:()=>o("amber"),children:e.jsx(l,{color:"amber",children:r("color.amber")})}),e.jsx(n,{onSelect:()=>o("orange"),children:e.jsx(l,{color:"orange",children:r("color.orange")})}),e.jsx(n,{onSelect:()=>o("tomato"),children:e.jsx(l,{color:"tomato",children:r("color.tomato")})}),e.jsx(n,{onSelect:()=>o("red"),children:e.jsx(l,{color:"red",children:r("color.red")})}),e.jsx(n,{onSelect:()=>o("ruby"),children:e.jsx(l,{color:"ruby",children:r("color.ruby")})}),e.jsx(n,{onSelect:()=>o("crimson"),children:e.jsx(l,{color:"crimson",children:r("color.crimson")})}),e.jsx(n,{onSelect:()=>o("pink"),children:e.jsx(l,{color:"pink",children:r("color.pink")})}),e.jsx(n,{onSelect:()=>o("plum"),children:e.jsx(l,{color:"plum",children:r("color.plum")})}),e.jsx(n,{onSelect:()=>o("purple"),children:e.jsx(l,{color:"purple",children:r("color.purple")})}),e.jsx(n,{onSelect:()=>o("violet"),children:e.jsx(l,{color:"violet",children:r("color.violet")})}),e.jsx(n,{onSelect:()=>o("iris"),children:e.jsx(l,{color:"iris",children:r("color.iris")})}),e.jsx(n,{onSelect:()=>o("indigo"),children:e.jsx(l,{color:"indigo",children:r("color.indigo")})}),e.jsx(n,{onSelect:()=>o("blue"),children:e.jsx(l,{color:"blue",children:r("color.blue")})}),e.jsx(n,{onSelect:()=>o("cyan"),children:e.jsx(l,{color:"cyan",children:r("color.cyan")})}),e.jsx(n,{onSelect:()=>o("teal"),children:e.jsx(l,{color:"teal",children:r("color.teal")})}),e.jsx(n,{onSelect:()=>o("jade"),children:e.jsx(l,{color:"jade",children:r("color.jade")})}),e.jsx(n,{onSelect:()=>o("green"),children:e.jsx(l,{color:"green",children:r("color.green")})}),e.jsx(n,{onSelect:()=>o("grass"),children:e.jsx(l,{color:"grass",children:r("color.grass")})}),e.jsx(n,{onSelect:()=>o("lime"),children:e.jsx(l,{color:"lime",children:r("color.lime")})}),e.jsx(n,{onSelect:()=>o("mint"),children:e.jsx(l,{color:"mint",children:r("color.mint")})}),e.jsx(n,{onSelect:()=>o("sky"),children:e.jsx(l,{color:"sky",children:r("color.sky")})})]})]})},fe=({icon:t=e.jsx(v,{variant:"soft",children:e.jsx(G,{})})}={})=>{const{setAppearance:o}=d.useContext(T),[r]=w();return e.jsxs(z,{children:[e.jsx(D,{children:t}),e.jsxs(F,{children:[e.jsx(n,{onSelect:()=>o("light"),children:r("theme.light","Light")}),e.jsx(n,{onSelect:()=>o("dark"),children:r("theme.dark","Dark")}),e.jsx(n,{onSelect:()=>o("system"),children:r("theme.system","System")})]})]})},Se=({trigger:t,autoOpen:o=!1,showSettings:r=!0,info:k,onLoginSuccess:C})=>{const $=()=>{const{account:x,loading:q,error:K,refresh:P}=X(),[c]=w(),[p,M]=d.useState(""),[g,N]=d.useState(""),[f,O]=d.useState(""),[_,u]=d.useState(""),[a,A]=d.useState(!1),[U,B]=d.useState(!1),[R,L]=d.useState(o||!1),{publicInfo:i}=V(),m=!(i!=null&&i.disable_password_login),J=!!(i!=null&&i.oauth_enable)&&!m,j=m&&p.trim()!==""&&g.trim()!=="";d.useEffect(()=>{o&&L(!0)},[o]);const S=async()=>{if(!j){u("Username and password are required");return}u(""),A(!0);try{const s=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,password:g,...f&&!(x!=null&&x["2fa_enabled"])?{"2fa_code":f}:{}})}),E=await s.json();if(s.status===200){if(P(),typeof C=="function"){C();return}window.open("/admin","_self")}else{if(E.message==="2FA code is required"){B(!0);return}u(E.message||"Login failed")}}catch(s){u("Network error"),console.error(s)}finally{A(!1)}},y=s=>{s.key==="Enter"&&!a&&j&&(s.preventDefault(),S())};if(q)return e.jsx(h,{disabled:!0,children:c("loading")});if(K||!x)return e.jsx(h,{disabled:!0,color:"red",children:"Error"});if(x.logged_in)return r?e.jsx("a",{href:"/admin",target:"_blank",children:e.jsx(v,{children:e.jsx(H,{})})}):null;if(J&&!o){const s=()=>{window.location.href="/api/oauth"};return t?typeof t=="string"?e.jsx(h,{onClick:s,children:t}):e.jsx("span",{onClick:s,style:{cursor:"pointer",display:"inline-flex"},children:t}):e.jsx(h,{onClick:s,children:c("login.title")})}return e.jsxs(Y,{open:R,onOpenChange:L,children:[e.jsx(Z,{children:t||e.jsx(h,{children:c("login.title")})}),e.jsxs(I,{maxWidth:"450px",children:[e.jsx(ee,{children:c("login.title")}),e.jsx(oe,{size:"2",mb:"4",children:e.jsxs("div",{className:"flex justify-center flex-col gap-2",children:[e.jsx("label",{children:c("login.desc")}),k&&e.jsx("label",{children:k})]})}),e.jsx(re,{onSubmit:s=>{s.preventDefault(),j&&!a&&S()},children:e.jsxs(le,{direction:"column",gap:"3",children:[m&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{children:[e.jsx(l,{as:"div",size:"2",mb:"1",weight:"bold",children:c("login.username")}),e.jsx(b,{value:p,onChange:s=>M(s.target.value),onKeyDown:y,placeholder:"admin",disabled:a,autoFocus:!0})]}),e.jsxs("label",{children:[e.jsx(l,{as:"div",size:"2",mb:"1",weight:"bold",children:c("login.password")}),e.jsx(b,{value:g,onChange:s=>N(s.target.value),onKeyDown:y,type:"password",placeholder:c("login.password_placeholder"),disabled:a})]}),e.jsxs("label",{hidden:!U,children:[e.jsx(l,{as:"div",size:"2",mb:"1",weight:"bold",children:c("login.two_factor")}),e.jsx(b,{value:f,onChange:s=>O(s.target.value),onKeyDown:y,type:"text",placeholder:"000000",disabled:a})]}),_&&e.jsx(l,{as:"div",size:"2",color:"red",children:_}),e.jsx(h,{type:"submit",disabled:a||!j,style:{opacity:a||!j?.6:1},onClick:S,children:a?"Logging in...":c("login.title")})]}),(i==null?void 0:i.oauth_enable)&&e.jsx(h,{onClick:()=>{window.location.href="/api/oauth"},variant:m?"soft":"solid",disabled:a,type:"button",children:c("login.login_with",{provider:(i==null?void 0:i.oauth_provider)==="generic"?"OAuth":i!=null&&i.oauth_provider?i.oauth_provider.charAt(0).toUpperCase()+i.oauth_provider.slice(1):""})})]})})]})]})};return e.jsx(Q,{children:e.jsx($,{})})};export{ge as C,Se as L,fe as T};
