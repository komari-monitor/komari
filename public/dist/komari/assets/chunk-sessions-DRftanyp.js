import{u as T,R as p,t as h,j as e,L as v}from"./entry-index-B_BwMGDA.js";import{T as L,a as y,b as w,c as m,d as D,e as x}from"./chunk-table-C7OLDXxB.js";import{s as f,n as d,p as b,g,m as N}from"./chunk-dialog-DNX9FVqx.js";import{o as j}from"./chunk-button-BYJQxefP.js";import{p as u}from"./chunk-flex-BCOyAvOQ.js";import"./chunk-utils-bRKmu4jq.js";import"./chunk-heading-DUyPxxaV.js";import"./chunk-base-button-CCk1VYTx.js";import"./chunk-text-2n0Dx3l-.js";import"./chunk-require-react-element-nXeqDkbS.js";class _{static parse(t=navigator.userAgent){const i=t.toLowerCase();let l="Unknown";i.includes("windows nt")?l="Windows":i.includes("mac os x")?l="macOS":i.includes("android")?l="Android":i.includes("iphone")||i.includes("ipad")?l="iOS":i.includes("linux")&&(l="Linux");let a="Unknown",s="0.0.0";if(i.includes("edg/")){a="Edge";const r=i.match(/edg\/(\d+\.\d+\.\d+)/);s=r?r[1]:s}else if(i.includes("chrome/")){a="Chrome";const r=i.match(/chrome\/(\d+\.\d+\.\d+)/);s=r?r[1]:s}else if(i.includes("firefox/")){a="Firefox";const r=i.match(/firefox\/(\d+\.\d+)/);s=r?r[1]:s}else if(i.includes("safari/")&&!i.includes("chrome")){a="Safari";const r=i.match(/version\/(\d+\.\d+)/);s=r?r[1]:s}return{device:l,browser:a,version:s}}static format(t){const{device:i,browser:l,version:a}=this.parse(t);return`${i} ${l}/${a}`}}function F(){const[n]=T(),[t,i]=p.useState(null);p.useEffect(()=>{fetch("/api/admin/session/get").then(s=>{if(!s.ok)throw new Error(`Error: ${s.status} ${s.statusText}`);return s.json()}).then(s=>{i(s)}).catch(s=>{console.error("Error fetching sessions:",s),h.error(s.message)})},[]);function l(s){const r=s===(t==null?void 0:t.current);fetch("/api/admin/session/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:s})}).then(c=>c.json()).then(c=>{if(c.status==="success"){if(h.success("会话已删除"),r){window.location.href="/";return}i(o=>({...o,data:(o==null?void 0:o.data.filter(C=>C.session!==s))||[]}))}else console.error("Failed to delete session:",c),h.error("删除失败")}).catch(c=>{console.error("Error deleting session:",c),h.error(c.message)})}function a(){fetch("/api/admin/session/remove/all",{method:"POST",headers:{"Content-Type":"application/json"}}).then(s=>{if(!s.ok){h.error("Error:"+s.status);return}s.json().then(()=>{window.location.href="/"}).catch(r=>{h.error("Error parsing JSON:"+r)})}).catch(s=>{h.error(s.message)})}return t?e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:n("sessions.title")}),e.jsx("div",{className:"mb-4",children:e.jsxs(f,{children:[e.jsx(d,{children:e.jsx(j,{color:"red",children:n("sessions.delete_all")})}),e.jsxs(b,{children:[e.jsx(g,{children:n("sessions.delete_all")}),e.jsx(N,{children:n("sessions.delete_all_desc")}),e.jsxs(u,{gap:"2",justify:"end",children:[e.jsx(d,{children:e.jsx(j,{variant:"soft",children:n("sessions.cancel")})}),e.jsx(d,{children:e.jsx(j,{color:"red",onClick:a,children:n("delete")})})]})]})]})}),e.jsx("div",{className:"overflow-hidden rounded-lg",children:e.jsxs(L,{children:[e.jsx(y,{children:e.jsxs(w,{children:[e.jsx(m,{children:n("sessions.session_id")}),e.jsx(m,{children:"UA"}),e.jsx(m,{children:"IP"}),e.jsx(m,{children:"Latest IP"}),e.jsx(m,{children:n("sessions.expires_at")}),e.jsx(m,{children:n("sessions.last_login","上次登录")}),e.jsx(m,{children:n("sessions.actions")})]})}),e.jsx(D,{children:t.data.map(s=>{const r=s.session===t.current;return e.jsxs(w,{children:[e.jsx(x,{children:e.jsxs(f,{children:[e.jsx(d,{children:e.jsxs("label",{className:"hover:underline cursor-pointer",children:[s.session.slice(0,8),"...",r&&e.jsx("span",{className:"ml-2 text-sm text-blue-600",children:n("sessions.current")})]})}),e.jsxs(b,{children:[e.jsx(g,{children:n("sessions.active_sessions")}),e.jsxs(u,{direction:"column",gap:"1",children:[e.jsx("label",{className:"text-base font-bold",children:n("sessions.session_id")}),e.jsx("label",{className:"text-sm",children:s.session}),e.jsxs("label",{className:"text-base font-bold",children:["IP / ",n("sessions.latest_ip","Latest IP")]}),e.jsxs("label",{className:"text-sm",children:[s.ip," / ",s.latest_ip]}),e.jsx("label",{className:"text-base font-bold",children:"User Agent"}),e.jsx("label",{className:"text-sm",children:s.user_agent}),e.jsx("label",{className:"text-sm text-muted-foreground font-bold",children:_.format(s.user_agent)}),e.jsx("label",{className:"text-base font-bold",children:n("sessions.last_user_agent")}),e.jsx("label",{className:"text-sm",children:s.latest_user_agent}),e.jsx("label",{className:"text-sm text-muted-foreground font-bold",children:_.format(s.latest_user_agent)}),e.jsx("label",{className:"text-base font-bold",children:n("sessions.login_method")}),e.jsx("label",{className:"text-sm",children:s.login_method}),e.jsx("label",{className:"text-base font-bold",children:n("sessions.latest_online","Latest Online")}),e.jsxs("label",{className:"text-sm",children:[new Date(s.latest_online).toLocaleString()," ","(",S(Date.now()-new Date(s.latest_online).getTime(),n),")"]}),e.jsx("label",{className:"text-base font-bold",children:n("sessions.created_at")}),e.jsx("label",{className:"text-sm",children:new Date(s.created_at).toLocaleString()}),e.jsx("label",{className:"text-base font-bold",children:n("sessions.expires_at","Expires At")}),e.jsx("label",{className:"text-sm",children:new Date(s.expires).toLocaleString()}),e.jsx(u,{justify:"end",children:e.jsx(d,{children:e.jsx(j,{variant:"soft",children:n("close")})})})]})]})]})}),e.jsx(x,{children:_.format(s.user_agent)}),e.jsx(x,{children:s.ip}),e.jsx(x,{children:s.latest_ip}),e.jsx(x,{children:new Date(s.expires).toLocaleString()}),e.jsxs(x,{children:[new Date(s.latest_online).toLocaleString()," ","(",S(Date.now()-new Date(s.latest_online).getTime(),n),")"]}),e.jsx(x,{children:e.jsxs(f,{children:[!r&&e.jsx(d,{children:e.jsx(j,{color:"red",variant:"ghost",children:n("delete")})}),e.jsxs(b,{children:[e.jsx(g,{children:n("sessions.confirm_delete")}),e.jsx(N,{children:n("sessions.delete_one_desc")}),e.jsxs(u,{gap:"2",justify:"end",children:[e.jsx(d,{children:e.jsx(j,{variant:"soft",children:n("sessions.cancel")})}),e.jsx(d,{children:e.jsx(j,{color:"red",onClick:()=>l(s.session),children:n("delete")})})]})]})]})})]},s.uuid)})})]})})]}):e.jsx(v,{})}function S(n,t){const i=Math.abs(n),l=Math.floor(i/1e3),a=Math.floor(l/60),s=Math.floor(a/60),r=Math.floor(s/24);if(l<60)return t("just_now");if(r>0){const o=s%24;return o>0?`${r}${t("nodeCard.time_day")}${o}${t("nodeCard.time_hour")}${t("time.ago")}`:`${r}${t("nodeCard.time_day")} ${t("time.ago")}`}if(s>0){const o=a%60;return o>0?`${s}${t("nodeCard.time_hour")}${o}${t("nodeCard.time_minute")}${t("time.ago")}`:`${s}${t("nodeCard.time_hour")}${t("time.ago")}`}const c=l%60;return`${a}${t("nodeCard.time_minute")}${c}${t("nodeCard.time_second")}${t("time.ago")}`}export{F as default};
