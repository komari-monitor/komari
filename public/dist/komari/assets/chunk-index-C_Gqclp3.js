import{c as Ve,R as $,r as L,u as Pe,v as Ie,e as ze,j as e,L as Be,b as Qe}from"./entry-index-B_BwMGDA.js";import{u as We,a as He}from"./chunk-NodeListContext-HYH4wDWx.js";import{F as Ze}from"./chunk-PriceTags-BunVVuX_.js";import{f as de,L as je,m as ve,i as he,C as ke,A as et,a as fe,b as Ce,c as tt,d as $e,h as at,e as rt,u as nt,g as Le,G as it,j as Ee,k as Oe,D as st,l as ot,X as Z,Y as ee,n as lt,o as Me,p as ae,q as re,r as ne,s as ie,t as Ne,v as xe,w as ct,x as ut,y as mt,z as dt}from"./chunk-Node-DFLplAAA.js";import{f as z}from"./chunk-unitHelper-BjgrQHpY.js";import{a as Ge}from"./chunk-utils-bRKmu4jq.js";import{p as oe}from"./chunk-flex-BCOyAvOQ.js";import{p as Se,l as _e}from"./chunk-segmented-control-IbHSJkfD.js";import{o as te}from"./chunk-card-CkJ954zg.js";import{T as De}from"./chunk-tips-Bm4H-aJC.js";import{D as ft}from"./chunk-react-icons.esm-C0BSBnU8.js";import{i as pt}from"./chunk-switch-CZ0Z7J0K.js";import{o as ht}from"./chunk-button-BYJQxefP.js";import{D as xt}from"./chunk-DetailsGrid-COPrC5FW.js";import{p as Te}from"./chunk-text-2n0Dx3l-.js";import"./chunk-box-B1i8JWQr.js";import"./chunk-badge-CENIML0j.js";import"./chunk-base-button-CCk1VYTx.js";import"./chunk-throttle-BvK4cc7c.js";import"./chunk-popover-CpHiNxfR.js";import"./chunk-require-react-element-nXeqDkbS.js";import"./chunk-trending-up-BH0T9zvj.js";import"./chunk-separator-H8QRyRNq.js";import"./chunk-icon-button-CMpL5Fj6.js";import"./chunk-internal-DlW9DyfA.js";import"./chunk-index-CC8wkri2.js";import"./chunk-index-B6kNq_40.js";import"./chunk-dialog-DNX9FVqx.js";import"./chunk-heading-DUyPxxaV.js";import"./chunk-index-BNFPzONB.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],yt=Ve("eye-off",gt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],jt=Ve("eye",bt);var vt=["layout","type","stroke","connectNulls","isRange","ref"],wt=["key"],Ue;function ge(a){"@babel/helpers - typeof";return ge=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ge(a)}function Xe(a,t){if(a==null)return{};var n=Nt(a,t),r,s;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);for(s=0;s<d.length;s++)r=d[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(n[r]=a[r])}return n}function Nt(a,t){if(a==null)return{};var n={};for(var r in a)if(Object.prototype.hasOwnProperty.call(a,r)){if(t.indexOf(r)>=0)continue;n[r]=a[r]}return n}function le(){return le=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(a[r]=n[r])}return a},le.apply(this,arguments)}function Re(a,t){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),n.push.apply(n,r)}return n}function se(a){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Re(Object(n),!0).forEach(function(r){J(a,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(n,r))})}return a}function _t(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function Ke(a,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,qe(r.key),r)}}function At(a,t,n){return t&&Ke(a.prototype,t),n&&Ke(a,n),Object.defineProperty(a,"prototype",{writable:!1}),a}function kt(a,t,n){return t=Ae(t),Dt(a,Ye()?Reflect.construct(t,n||[],Ae(a).constructor):t.apply(a,n))}function Dt(a,t){if(t&&(ge(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Lt(a)}function Lt(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ye(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ye=function(){return!!a})()}function Ae(a){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ae(a)}function Ft(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(t&&t.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),t&&Fe(a,t)}function Fe(a,t){return Fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Fe(a,t)}function J(a,t,n){return t=qe(t),t in a?Object.defineProperty(a,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[t]=n,a}function qe(a){var t=Pt(a,"string");return ge(t)=="symbol"?t:t+""}function Pt(a,t){if(ge(a)!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var r=n.call(a,t);if(ge(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}var W=function(a){function t(){var n;_t(this,t);for(var r=arguments.length,s=new Array(r),d=0;d<r;d++)s[d]=arguments[d];return n=kt(this,t,[].concat(s)),J(n,"state",{isAnimationFinished:!0}),J(n,"id",nt("recharts-area-")),J(n,"handleAnimationEnd",function(){var o=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Le(o)&&o()}),J(n,"handleAnimationStart",function(){var o=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Le(o)&&o()}),n}return Ft(t,a),At(t,[{key:"renderDots",value:function(r,s,d){var o=this.props.isAnimationActive,u=this.state.isAnimationFinished;if(o&&!u)return null;var p=this.props,h=p.dot,x=p.points,y=p.dataKey,b=de(this.props,!1),S=de(h,!0),j=x.map(function(N,D){var g=se(se(se({key:"dot-".concat(D),r:3},b),S),{},{index:D,cx:N.x,cy:N.y,dataKey:y,value:N.value,payload:N.payload,points:x});return t.renderDotItem(h,g)}),P={clipPath:r?"url(#clipPath-".concat(s?"":"dots-").concat(d,")"):null};return $.createElement(je,le({className:"recharts-area-dots"},P),j)}},{key:"renderHorizontalRect",value:function(r){var s=this.props,d=s.baseLine,o=s.points,u=s.strokeWidth,p=o[0].x,h=o[o.length-1].x,x=r*Math.abs(p-h),y=ve(o.map(function(b){return b.y||0}));return he(d)&&typeof d=="number"?y=Math.max(d,y):d&&Array.isArray(d)&&d.length&&(y=Math.max(ve(d.map(function(b){return b.y||0})),y)),he(y)?$.createElement("rect",{x:p<h?p:p-x,y:0,width:x,height:Math.floor(y+(u?parseInt("".concat(u),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var s=this.props,d=s.baseLine,o=s.points,u=s.strokeWidth,p=o[0].y,h=o[o.length-1].y,x=r*Math.abs(p-h),y=ve(o.map(function(b){return b.x||0}));return he(d)&&typeof d=="number"?y=Math.max(d,y):d&&Array.isArray(d)&&d.length&&(y=Math.max(ve(d.map(function(b){return b.x||0})),y)),he(y)?$.createElement("rect",{x:0,y:p<h?p:p-x,width:y+(u?parseInt("".concat(u),10):1),height:Math.floor(x)}):null}},{key:"renderClipRect",value:function(r){var s=this.props.layout;return s==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,s,d,o){var u=this.props,p=u.layout,h=u.type,x=u.stroke,y=u.connectNulls,b=u.isRange;u.ref;var S=Xe(u,vt);return $.createElement(je,{clipPath:d?"url(#clipPath-".concat(o,")"):null},$.createElement(ke,le({},de(S,!0),{points:r,connectNulls:y,type:h,baseLine:s,layout:p,stroke:"none",className:"recharts-area-area"})),x!=="none"&&$.createElement(ke,le({},de(this.props,!1),{className:"recharts-area-curve",layout:p,type:h,connectNulls:y,fill:"none",points:r})),x!=="none"&&b&&$.createElement(ke,le({},de(this.props,!1),{className:"recharts-area-curve",layout:p,type:h,connectNulls:y,fill:"none",points:s})))}},{key:"renderAreaWithAnimation",value:function(r,s){var d=this,o=this.props,u=o.points,p=o.baseLine,h=o.isAnimationActive,x=o.animationBegin,y=o.animationDuration,b=o.animationEasing,S=o.animationId,j=this.state,P=j.prevPoints,N=j.prevBaseLine;return $.createElement(et,{begin:x,duration:y,isActive:h,easing:b,from:{t:0},to:{t:1},key:"area-".concat(S),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(D){var g=D.t;if(P){var O=P.length/u.length,w=u.map(function(v,R){var X=Math.floor(R*O);if(P[X]){var M=P[X],I=fe(M.x,v.x),G=fe(M.y,v.y);return se(se({},v),{},{x:I(g),y:G(g)})}return v}),k;if(he(p)&&typeof p=="number"){var f=fe(N,p);k=f(g)}else if(Ce(p)||tt(p)){var C=fe(N,0);k=C(g)}else k=p.map(function(v,R){var X=Math.floor(R*O);if(N[X]){var M=N[X],I=fe(M.x,v.x),G=fe(M.y,v.y);return se(se({},v),{},{x:I(g),y:G(g)})}return v});return d.renderAreaStatically(w,k,r,s)}return $.createElement(je,null,$.createElement("defs",null,$.createElement("clipPath",{id:"animationClipPath-".concat(s)},d.renderClipRect(g))),$.createElement(je,{clipPath:"url(#animationClipPath-".concat(s,")")},d.renderAreaStatically(u,p,r,s)))})}},{key:"renderArea",value:function(r,s){var d=this.props,o=d.points,u=d.baseLine,p=d.isAnimationActive,h=this.state,x=h.prevPoints,y=h.prevBaseLine,b=h.totalLength;return p&&o&&o.length&&(!x&&b>0||!$e(x,o)||!$e(y,u))?this.renderAreaWithAnimation(r,s):this.renderAreaStatically(o,u,r,s)}},{key:"render",value:function(){var r,s=this.props,d=s.hide,o=s.dot,u=s.points,p=s.className,h=s.top,x=s.left,y=s.xAxis,b=s.yAxis,S=s.width,j=s.height,P=s.isAnimationActive,N=s.id;if(d||!u||!u.length)return null;var D=this.state.isAnimationFinished,g=u.length===1,O=Ge("recharts-area",p),w=y&&y.allowDataOverflow,k=b&&b.allowDataOverflow,f=w||k,C=Ce(N)?this.id:N,v=(r=de(o,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},R=v.r,X=R===void 0?3:R,M=v.strokeWidth,I=M===void 0?2:M,G=at(o)?o:{},ce=G.clipDot,ue=ce===void 0?!0:ce,K=X*2+I;return $.createElement(je,{className:O},w||k?$.createElement("defs",null,$.createElement("clipPath",{id:"clipPath-".concat(C)},$.createElement("rect",{x:w?x:x-S/2,y:k?h:h-j/2,width:w?S:S*2,height:k?j:j*2})),!ue&&$.createElement("clipPath",{id:"clipPath-dots-".concat(C)},$.createElement("rect",{x:x-K/2,y:h-K/2,width:S+K,height:j+K}))):null,g?null:this.renderArea(f,C),(o||g)&&this.renderDots(f,ue,C),(!P||D)&&rt.renderCallByParent(this.props,u))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:s.curPoints,prevBaseLine:s.curBaseLine}:r.points!==s.curPoints||r.baseLine!==s.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])}(L.PureComponent);Ue=W;J(W,"displayName","Area");J(W,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!it.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});J(W,"getBaseValue",function(a,t,n,r){var s=a.layout,d=a.baseValue,o=t.props.baseValue,u=o??d;if(he(u)&&typeof u=="number")return u;var p=s==="horizontal"?r:n,h=p.scale.domain();if(p.type==="number"){var x=Math.max(h[0],h[1]),y=Math.min(h[0],h[1]);return u==="dataMin"?y:u==="dataMax"||x<0?x:Math.max(Math.min(h[0],h[1]),0)}return u==="dataMin"?h[0]:u==="dataMax"?h[1]:h[0]});J(W,"getComposedData",function(a){var t=a.props,n=a.item,r=a.xAxis,s=a.yAxis,d=a.xAxisTicks,o=a.yAxisTicks,u=a.bandSize,p=a.dataKey,h=a.stackedData,x=a.dataStartIndex,y=a.displayedData,b=a.offset,S=t.layout,j=h&&h.length,P=Ue.getBaseValue(t,n,r,s),N=S==="horizontal",D=!1,g=y.map(function(w,k){var f;j?f=h[x+k]:(f=Ee(w,p),Array.isArray(f)?D=!0:f=[P,f]);var C=f[1]==null||j&&Ee(w,p)==null;return N?{x:Oe({axis:r,ticks:d,bandSize:u,entry:w,index:k}),y:C?null:s.scale(f[1]),value:f,payload:w}:{x:C?null:r.scale(f[1]),y:Oe({axis:s,ticks:o,bandSize:u,entry:w,index:k}),value:f,payload:w}}),O;return j||D?O=g.map(function(w){var k=Array.isArray(w.value)?w.value[0]:null;return N?{x:w.x,y:k!=null&&w.y!=null?s.scale(k):null}:{x:k!=null?r.scale(k):null,y:w.y}}):O=N?s.scale(P):r.scale(P),se({points:g,baseLine:O,layout:S,isRange:D},b)});J(W,"renderDotItem",function(a,t){var n;if($.isValidElement(a))n=$.cloneElement(a,t);else if(Le(a))n=a(t);else{var r=Ge("recharts-area-dot",typeof a!="boolean"?a.className:""),s=t.key,d=Xe(t,wt);n=$.createElement(st,le({},d,{key:s,className:r}))}return n});var we=ot({chartName:"AreaChart",GraphicalChild:W,axisComponents:[{axisType:"xAxis",AxisComp:Z},{axisType:"yAxis",AxisComp:ee}],formatAxisMap:lt});const St=({data:a=[]})=>{var ye,be,i,c,A,H;const{t}=Pe(),{live_data:n}=We(),{uuid:r}=Ie(),{nodeList:s}=He(),{publicInfo:d}=ze(),o=(d==null?void 0:d.record_preserve_time)||0,[u,p]=L.useState("real-time"),[h,x]=L.useState(null),[y,b]=L.useState(!1),[S,j]=L.useState(null);L.useEffect(()=>{N.length>0&&p(N[0].label)},[o]);const P=[{label:t("chart.hours",{count:4}),hours:4},{label:t("chart.days",{count:1}),hours:24},{label:t("chart.days",{count:7}),hours:168},{label:t("chart.days",{count:30}),hours:720}],N=[{label:t("common.real_time")}];if(typeof o=="number"&&o>0){for(const m of P)o>=m.hours&&N.push({label:m.label,hours:m.hours});const l=P[P.length-1];if(o>l.hours){const m=o%24===0?`${t("chart.days",{count:Math.floor(o/24)})}`:`${t("chart.hours",{count:o})}`;N.push({label:m,hours:o})}else if(o>4&&!P.some(m=>m.hours===o)){const m=o%24===0?`${t("chart.days",{count:Math.floor(o/24)})}`:`${t("chart.hours",{count:o})}`;N.push({label:m,hours:o})}}L.useEffect(()=>{const l=N.find(m=>m.label===u);if(r){if(!l||!l.hours){x(null),j(null),b(!1);return}b(!0),j(null),fetch(`/api/records/load?uuid=${r}&hours=${l.hours}`).then(m=>{if(!m.ok)throw new Error(m.statusText);return m.json()}).then(m=>{var E,Y;const _=((E=m.data)==null?void 0:E.records)||[],T=((Y=m.data)==null?void 0:Y.gpu_devices)||{},V=_.map(F=>{var Q;const B=[];for(const q in T){const U=(Q=T[q].records)==null?void 0:Q.find(Je=>new Date(Je.time).getTime()===new Date(F.time).getTime());U&&B.push({usage:U.utilization,memory:U.mem_used/U.mem_total*100,temperature:U.temperature,device_index:U.device_index,device_name:U.device_name,mem_total:U.mem_total,mem_used:U.mem_used})}return{...F,gpu_detailed:B.length>0?B:void 0}});V.sort((F,B)=>new Date(F.time).getTime()-new Date(B.time).getTime()),x(V),b(!1)}).catch(m=>{j(m.message||"Error"),b(!1)})}},[u,r]);const D=["#F38181","#FCE38A","#EAFFD0","#95E1D3"],g=D[0],O=D[1],w="max-w-72 min-w-72 flex flex-col w-full h-full gap-4",k={top:0,right:16,bottom:0,left:16},f=(ye=n==null?void 0:n.data)==null?void 0:ye.data[r??""],C=(l,m)=>m===0||m===K.length-1?P[0].label===u||u==="real-time"||u===t("common.real_time")?new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(l).toLocaleDateString([],{month:"2-digit",day:"2-digit"}):"",v=s==null?void 0:s.find(l=>l.uuid===r),R=l=>{const m=new Date(l);return u===t("common.real_time")||u==="real-time"?m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):m.toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},X=l=>`${l.toFixed(2)}%`,M=(l,m)=>e.jsxs(oe,{justify:"between",align:"center",className:"mb-2",children:[e.jsx("label",{className:"text-xl font-bold",children:l}),e.jsx("label",{className:"text-sm text-muted-foreground",children:m})]}),I=60,G=I*60,ce=u===t("common.real_time")||u==="real-time",ue=Array.isArray(a)?a.slice(-150):a,K=ce?ue:u===P[0].label?Me(h??[],I,G*4,I*2):(()=>{var T,V;const l=((T=P.find(E=>E.label===u))==null?void 0:T.hours)||((V=N.find(E=>E.label===u))==null?void 0:V.hours)||24,m=l>120?G:I*15,_=m*2;return Me(h??[],m,G*l,_)})();return e.jsxs(oe,{direction:"column",align:"center",gap:"4",className:"w-full max-w-screen",children:[e.jsx("div",{className:"w-full overflow-x-auto px-2",children:e.jsx("div",{className:"w-max mx-auto",children:e.jsx(Se,{value:u,onValueChange:p,children:N.map(l=>e.jsx(_e,{value:l.label,className:"capitalize",children:l.label==="real-time"?t("common.real_time"):l.label},l.label))})})}),y&&e.jsx("div",{style:{textAlign:"center",width:"100%"},children:e.jsx(Be,{})}),S&&e.jsx("div",{style:{color:"red",textAlign:"center",width:"100%"},children:S}),e.jsxs("div",{className:"gap-2 grid w-full justify-items-center mx-auto max-w-[900px]",style:{gridTemplateColumns:"repeat(auto-fit, minmax(288px, 1fr))"},children:[e.jsxs(te,{className:w,children:[M("CPU",(be=f==null?void 0:f.cpu)!=null&&be.usage?`${f.cpu.usage.toFixed(2)}%`:"-"),e.jsx(ae,{config:{cpu:{label:"CPU",color:g}},children:e.jsxs(we,{data:K,accessibilityLayer:!0,margin:k,children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:C,interval:0}),e.jsx(ee,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(l,m)=>m!==0?`${l}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,formatter:X,content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(W,{dataKey:"cpu",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1})]})})]}),e.jsxs(te,{className:w,children:[M("Ram",e.jsxs(oe,{gap:"0",direction:"column",align:"end",className:"text-sm",children:[e.jsx("label",{children:(i=f==null?void 0:f.ram)!=null&&i.used?`${z(f.ram.used)} / ${z((v==null?void 0:v.mem_total)||0)}`:"-"}),e.jsx("label",{children:(c=f==null?void 0:f.swap)!=null&&c.used?`${z(f.swap.used)} / ${z((v==null?void 0:v.swap_total)||0)}`:"-"})]})),e.jsx(ae,{config:{ram:{label:"Ram",color:g},swap:{label:"Swap",color:O}},children:e.jsxs(we,{data:K.map(l=>({time:l.time,ram:(l.ram??0)/((v==null?void 0:v.mem_total)??1)*100,ram_raw:l.ram,swap:(l.swap??0)/((v==null?void 0:v.swap_total)??1)*100,swap_raw:l.swap,client:l.client})),accessibilityLayer:!0,margin:k,children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:C,interval:0}),e.jsx(ee,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(l,m)=>m!==0?`${l}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,formatter:(l,m,_)=>{const T=(_==null?void 0:_.payload)||{};let V=0;m==="ram"?V=T.ram_raw??0:m==="swap"&&(V=T.swap_raw??0);let E=0;if(typeof l=="number")E=l;else if(typeof l=="string"){const Y=parseFloat(l);E=isNaN(Y)?0:Y}else Array.isArray(l)&&(E=typeof l[0]=="number"?l[0]:parseFloat(l[0]||"0"));return`${z(V)} (${E.toFixed(0)}%)`},content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(W,{dataKey:"ram",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(W,{dataKey:"swap",animationDuration:0,stroke:O,fill:O,opacity:.8,dot:!1})]})})]}),e.jsxs(te,{className:w,children:[M("Disk",(A=f==null?void 0:f.disk)!=null&&A.used?`${z(f.disk.used)} / ${z((v==null?void 0:v.disk_total)||0)}`:"-"),e.jsx(ae,{config:{disk:{label:"Disk",color:g}},children:e.jsxs(we,{data:K,accessibilityLayer:!0,margin:k,children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:C,interval:0}),e.jsx(ee,{tickLine:!1,axisLine:!1,domain:[0,(v==null?void 0:v.disk_total)||100],tickFormatter:(l,m)=>m!==0?`${z(l)}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,formatter:z,content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(W,{dataKey:"disk",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1})]})})]}),e.jsxs(te,{className:w,children:[M(t("nodeCard.networkSpeed"),e.jsxs(oe,{gap:"0",align:"end",direction:"column",className:"text-sm",children:[e.jsxs("span",{children:["↑ ",z((f==null?void 0:f.network.up)||0),"/s"]}),e.jsxs("span",{children:["↓ ",z((f==null?void 0:f.network.down)||0),"/s"]})]})),e.jsx(ae,{config:{net_in:{label:t("chart.network_down"),color:g},net_out:{label:t("chart.network_up"),color:D[3]}},children:e.jsxs(Ne,{data:K,accessibilityLayer:!0,margin:k,children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:C,interval:0}),e.jsx(ee,{tickLine:!1,axisLine:!1,tickFormatter:(l,m)=>m!==0?`${z(l)}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,formatter:z,content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(xe,{dataKey:"net_in",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(xe,{dataKey:"net_out",animationDuration:0,stroke:D[3],fill:D[3],opacity:.8,dot:!1})]})})]}),e.jsxs(te,{className:w,children:[M(t("chart.connections"),e.jsxs(oe,{gap:"0",align:"end",direction:"column",className:"text-sm",children:[e.jsxs("span",{children:["TCP: ",f==null?void 0:f.connections.tcp]}),e.jsxs("span",{children:["UDP: ",f==null?void 0:f.connections.udp]})]})),e.jsx(ae,{config:{connections:{label:"TCP",color:g},connections_udp:{label:"UDP",color:D[3]}},children:e.jsxs(Ne,{data:K,accessibilityLayer:!0,margin:k,children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:C,interval:0}),e.jsx(ee,{tickLine:!1,axisLine:!1,tickFormatter:(l,m)=>m!==0?`${l}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(xe,{dataKey:"connections",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(xe,{dataKey:"connections_udp",animationDuration:0,stroke:D[3],fill:D[3],opacity:.8,dot:!1})]})})]}),e.jsxs(te,{className:w,children:[M(t("chart.process"),f==null?void 0:f.process),e.jsx(ae,{config:{process:{label:t("chart.process"),color:g}},children:e.jsxs(Ne,{data:K,accessibilityLayer:!0,margin:k,children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:C,interval:0}),e.jsx(ee,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(l,m)=>m!==0?`${l}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(xe,{dataKey:"process",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1})]})})]}),(f==null?void 0:f.gpu)&&f.gpu.count>0&&((H=f.gpu.detailed_info)==null?void 0:H.map((l,m)=>e.jsxs(te,{className:w,children:[e.jsxs(oe,{direction:"column",gap:"2",className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xl font-bold",children:`GPU ${m+1}: ${l.name}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:z(l.memory_total)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:t("chart.usage")}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[l.utilization,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:t("chart.gpu_memory")}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[(l.memory_used/l.memory_total*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:t("nodeCard.temperature")}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[l.temperature,"°C"]})]})]})]}),e.jsx(ae,{config:{gpu_usage:{label:"GPU",color:g},gpu_memory:{label:t("chart.gpu_memory"),color:O},gpu_temp:{label:t("nodeCard.temperature"),color:D[2]}},children:e.jsxs(we,{data:K.map(_=>{var T,V,E,Y,F,B,Q,q,me,U;return{time:_.time,gpu_usage:((V=(T=_.gpu_detailed)==null?void 0:T[m])==null?void 0:V.usage)??_.gpu_usage??0,gpu_memory:((Y=(E=_.gpu_detailed)==null?void 0:E[m])==null?void 0:Y.memory)??_.gpu_memory??0,gpu_memory_raw:((B=(F=_.gpu_detailed)==null?void 0:F[m])==null?void 0:B.mem_used)??l.memory_total*(((q=(Q=_.gpu_detailed)==null?void 0:Q[m])==null?void 0:q.memory)||0)/100,gpu_temp:((U=(me=_.gpu_detailed)==null?void 0:me[m])==null?void 0:U.temperature)??0,client:_.client}}),accessibilityLayer:!0,margin:k,children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:C,interval:0}),e.jsx(ee,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(_,T)=>T!==0?`${_}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,formatter:(_,T,V)=>{var E;if(T==="gpu_temp")return`${_}°C`;if(T==="gpu_usage")return`${Number(_).toFixed(1)}%`;if(T==="gpu_memory"){const Y=Number(_).toFixed(1),F=((E=V.payload)==null?void 0:E.gpu_memory_raw)||0;return`${z(F)}(${Y}%)`}return`${Number(_).toFixed(1)}`},content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(W,{dataKey:"gpu_usage",animationDuration:0,stroke:g,fill:g,opacity:.8,dot:!1}),e.jsx(W,{dataKey:"gpu_memory",animationDuration:0,stroke:O,fill:O,opacity:.8,dot:!1}),e.jsx(W,{dataKey:"gpu_temp",animationDuration:0,stroke:D[2],fill:D[2],opacity:.6,dot:!1})]})})]},`gpu-${m}`)))]})]})},pe=["#F38181","#347433","#898AC4","#03A6A1","#7AD6F0","#B388FF","#FF8A65","#FFD600"],Ct=({uuid:a})=>{var K,ye,be;const{t}=Pe(),{publicInfo:n}=ze(),{call:r}=Qe(),s=(n==null?void 0:n.ping_record_preserve_time)||0,d=[{label:t("chart.hours",{count:1}),hours:1},{label:t("chart.hours",{count:6}),hours:6},{label:t("chart.hours",{count:12}),hours:12},{label:t("chart.days",{count:1}),hours:24}],o=[];if(typeof s=="number"&&s>0){for(const c of d)s>=c.hours&&o.push({label:c.label,hours:c.hours});const i=d[d.length-1];if(s>i.hours){const c=s%24===0?`${t("chart.days",{count:Math.floor(s/24)})}`:`${t("chart.hours",{count:s})}`;o.push({label:c,hours:s})}else if(s>1&&!d.some(c=>c.hours===s)){const c=s%24===0?`${t("chart.days",{count:Math.floor(s/24)})}`:`${t("chart.hours",{count:s})}`;o.push({label:c,hours:s})}}const u=((K=o.find(i=>i.hours===1))==null?void 0:K.label)||((ye=o[0])==null?void 0:ye.label)||"",[p,h]=L.useState(u),[x,y]=L.useState(((be=o.find(i=>i.label===u))==null?void 0:be.hours)||1),[b,S]=L.useState(null),[j,P]=L.useState([]),[N,D]=L.useState(!1),[g,O]=L.useState(null),[w,k]=L.useState(!1);L.useEffect(()=>{const i=o.find(c=>c.label===p);i&&i.hours!==void 0&&y(i.hours)},[p,o]),L.useEffect(()=>{if(!a)return;if(!x){S(null),O(null),D(!1);return}D(!0),O(null);const i=new AbortController;return(async()=>{try{const c=await r("common:getRecords",{uuid:a,type:"ping",hours:x}),A=(c==null?void 0:c.records)||[];A.sort((H,l)=>new Date(H.time).getTime()-new Date(l.time).getTime()),S(A),P((c==null?void 0:c.tasks)||[]),D(!1)}catch(c){O((c==null?void 0:c.message)||"Error"),D(!1)}})(),()=>i.abort()},[x,a]);const f=L.useMemo(()=>{const i=b||[];if(!i.length)return[];const c=j.map(F=>F.interval).filter(F=>typeof F=="number"&&F>0),A=c.length?Math.min(...c):60,H=Math.min(6e3,Math.max(800,Math.floor(A*1e3*.25))),l={},m=[];for(const F of i){const B=new Date(F.time).getTime();let Q=null;for(const me of m)if(Math.abs(me-B)<=H){Q=me;break}const q=Q??B;l[q]||(l[q]={time:new Date(q).toISOString()},Q===null&&m.push(q)),l[q][F.task_id]=F.value<0?null:F.value}const _=Object.values(l).sort((F,B)=>new Date(F.time).getTime()-new Date(B.time).getTime()),V=new Date(_[_.length-1].time).getTime()-x*36e5;let E=0;for(let F=0;F<_.length;F++)if(new Date(_[F].time).getTime()>=V){E=Math.max(0,F-1);break}return _.slice(E)},[b,j,x]),C=L.useMemo(()=>{let i=f;if(w&&j.length>0){const c=j.map(A=>String(A.id));i=ct(f,c)}if(j.length>0&&i.length>0){const c=j.map(A=>String(A.id));i=ut(i,c,{maxGapMultiplier:6,minCapMs:2*6e4,maxCapMs:30*6e4})}return i},[b,w,j,x]),v=(i,c)=>C.length&&(c===0||c===C.length-1)?x<24?new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(i).toLocaleDateString([],{month:"2-digit",day:"2-digit"}):"",R=i=>{const c=new Date(i);return x<24?c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):c.toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},X=L.useMemo(()=>{const i={};return j.forEach((c,A)=>{i[c.id]={label:`${c.name}${typeof c.p99_p50_ratio=="number"?` (${t("chart.volatility")}: ${c.p99_p50_ratio.toFixed(2)})`:""}`,color:pe[A%pe.length]}}),i},[j]),M=L.useMemo(()=>{if(!b||!j.length)return[];const i=new Map;for(const c of j)for(let A=b.length-1;A>=0;A--){const H=b[A];if(H.task_id===c.id&&H.value>=0){i.set(c.id,H);break}}return j.map((c,A)=>{var H,l;return{...c,value:((H=i.get(c.id))==null?void 0:H.value)??null,time:((l=i.get(c.id))==null?void 0:l.time)??null,color:pe[A%pe.length]}})},[b,j]),[I,G]=L.useState({}),ce=L.useCallback(i=>{const c=i.dataKey;G(A=>({...A,[c]:!A[c]}))},[]),ue=L.useCallback(()=>{const i=j.every(A=>I[String(A.id)]),c={};j.forEach(A=>{c[String(A.id)]=!i}),G(c)},[j,I]);return e.jsxs(oe,{direction:"column",align:"center",gap:"4",className:"w-full max-w-screen",children:[e.jsx("div",{className:"w-full overflow-x-auto px-2",children:e.jsx("div",{className:"w-max mx-auto",children:e.jsx(Se,{value:p,onValueChange:i=>{h(i);const c=o.find(A=>A.label===i);c&&c.hours!==void 0&&y(c.hours)},children:o.map(i=>e.jsx(_e,{value:i.label,className:"capitalize",children:i.label},i.label))})})}),N&&e.jsx("div",{style:{textAlign:"center",width:"100%"},children:e.jsx(Be,{})}),g&&e.jsx("div",{style:{color:"red",textAlign:"center",width:"100%"},children:g}),M.length>0?e.jsxs(te,{className:"w-full max-w-[900px] mb-2",children:[e.jsx(De,{className:"absolute top-0 right-0 m-2",children:e.jsx("label",{children:t("chart.loss_tips")})}),e.jsx("div",{className:"grid gap-2 mb-2 w-full",style:{gridTemplateColumns:"repeat(auto-fit, minmax(240px,1fr))"},children:M.map(i=>e.jsxs("div",{className:"flex flex-row items-center rounded",children:[e.jsx("div",{className:"w-1 h-6 rounded-xs ",style:{backgroundColor:i.color}}),e.jsxs("div",{className:"flex items-start justify-center ml-1 flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1 -mb-1",children:[e.jsx("label",{className:"font-bold text-md",children:i.name}),e.jsx(De,{side:"top",trigger:e.jsx(ft,{className:"cursor-pointer",color:"gray"}),children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[typeof i.min=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.min")}),e.jsxs("span",{className:"font-mono",children:[Math.round(i.min)," ms"]})]}),typeof i.max=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.max")}),e.jsxs("span",{className:"font-mono",children:[Math.round(i.max)," ms"]})]}),typeof i.avg=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.avg")}),e.jsxs("span",{className:"font-mono",children:[Math.round(i.avg)," ms"]})]}),typeof i.latest=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.latest")}),e.jsxs("span",{className:"font-mono",children:[Math.round(i.latest)," ms"]})]}),typeof i.p99_p50_ratio=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.volatility")}),e.jsx("span",{className:"font-mono",children:i.p99_p50_ratio.toFixed(2)})]}),typeof i.p50=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"p50"}),e.jsxs("span",{className:"font-mono",children:[Math.round(i.p50)," ms"]})]}),typeof i.p99=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"p99"}),e.jsxs("span",{className:"font-mono",children:[Math.round(i.p99)," ms"]})]}),typeof i.loss=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.lossRate")}),e.jsxs("span",{className:"font-mono",children:[Number(i.loss).toFixed(1),"%"]})]}),typeof i.interval=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.interval")}),e.jsxs("span",{className:"font-mono",children:[i.interval,"s"]})]}),i.type&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.type")}),e.jsx("span",{className:"font-mono uppercase",children:i.type})]}),typeof i.total=="number"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:t("chart.total")}),e.jsx("span",{className:"font-mono",children:i.total})]})]})})]}),e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:i.value!==null?`${Number(i.value).toFixed(0)} ms`:"-"}),e.jsx("span",{children:`${Number(i.loss).toFixed(1)}%${t("chart.lossRate")}`}),typeof i.p99_p50_ratio=="number"&&e.jsxs("span",{title:"p99/p50",children:[i.p99_p50_ratio.toFixed(1),t("chart.volatility")]})]})]})]},i.id))})]}):e.jsx("div",{className:"w-full max-w-[900px] text-center text-muted-foreground mb-2",children:t("common.none")}),e.jsxs(te,{className:"w-full max-w-[900px]",children:[C.length===0?e.jsx("div",{className:"w-full h-40 flex items-center justify-center text-muted-foreground",children:t("common.none")}):e.jsx(ae,{config:X,children:e.jsxs(Ne,{data:C,accessibilityLayer:!0,margin:{top:0,right:16,bottom:0,left:16},children:[e.jsx(re,{vertical:!1}),e.jsx(Z,{dataKey:"time",tickLine:!1,tickFormatter:v,interval:"preserveStartEnd",minTickGap:30,allowDuplicatedCategory:!1}),e.jsx(ee,{tickLine:!1,axisLine:!1,unit:"ms",allowDecimals:!1,orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(ne,{cursor:!1,formatter:i=>`${Math.round(i)} ms`,content:e.jsx(ie,{labelFormatter:R,indicator:"dot"})}),e.jsx(mt,{onClick:ce}),j.map((i,c)=>e.jsx(xe,{dataKey:String(i.id),name:i.name,stroke:pe[c%pe.length],dot:!1,isAnimationActive:!1,strokeWidth:2,connectNulls:!1,type:w?"basis":"linear",hide:!!I[String(i.id)]},i.id))]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4",style:{display:N?"none":"flex"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{id:"cut-peak",checked:w,onCheckedChange:k}),e.jsxs("label",{htmlFor:"cut-peak",className:"text-sm font-medium flex items-center gap-1 flex-row",children:[t("chart.cutPeak"),e.jsx(De,{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t("chart.cutPeak_tips")}})})]})]}),e.jsx(ht,{variant:"soft",size:"2",onClick:ue,className:"flex items-center gap-2",children:j.every(i=>I[String(i.id)])?e.jsxs(e.Fragment,{children:[e.jsx(jt,{size:16}),t("chart.showAll")]}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{size:16}),t("chart.hideAll")]})})]})]})]})};function ca(){const{t:a}=Pe(),{onRefresh:t}=We(),{uuid:n}=Ie(),[r,s]=L.useState([]),{nodeList:d}=He(),[o,u]=L.useState("load"),p=d==null?void 0:d.find(h=>h.uuid===n);return L.useEffect(()=>{fetch(`/api/recent/${n}`).then(h=>h.json()).then(h=>s(h.data.slice(-150))).catch(h=>console.error("Failed to fetch recent data:",h))},[n]),L.useEffect(()=>t(x=>{if(!n)return;const y=x.data.data[n];y&&s(b=>{const S=y;return b.some(N=>N.updated_at===S.updated_at)?b:[...b,S].slice(-150)})}),[t,n]),e.jsxs(oe,{className:"items-center",direction:"column",gap:"2",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:p-4 p-3 border-0 rounded-md",children:[e.jsxs("h1",{className:"flex items-center flex-wrap",children:[e.jsx(Ze,{flag:(p==null?void 0:p.region)??""}),e.jsx(Te,{size:"3",weight:"bold",wrap:"nowrap",children:(p==null?void 0:p.name)??n}),e.jsx(Te,{size:"1",style:{marginLeft:"8px"},className:"text-accent-6",wrap:"nowrap",children:p==null?void 0:p.uuid})]}),e.jsx(xt,{box:!0,align:"center",uuid:n??""})]}),e.jsxs(Se,{radius:"full",value:o,onValueChange:h=>u(h),children:[e.jsx(_e,{value:"load",children:a("nodeCard.load")}),e.jsx(_e,{value:"ping",children:a("nodeCard.ping")})]}),o==="load"?e.jsx(St,{data:dt(n??"",r)}):e.jsx(Ct,{uuid:n??""}),e.jsx("div",{className:"grid w-full items-center justify-center mx-auto h-full gap-4 p-1 md:grid-cols-[repeat(auto-fit,minmax(620px,1fr))] grid-cols-[repeat(auto-fit,minmax(320px,1fr))]"})]})}export{ca as default};
